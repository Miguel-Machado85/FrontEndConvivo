<div class="modificar-popup-backdrop" (click)="close()"></div>
<div class="modificar-popup">
    <div class="modificar-popup-header">
        <div class="modificar-popup-title">Modificar Reserva - {{reserva?.espacio?.nombre}}</div>
        <button class="close-btn" (click)="close()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18" stroke="#717182" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M6 6L18 18" stroke="#717182" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </button>
    </div>
    <div class="modificar-popup-desc">
        Modifica fecha, hora y cantidad de personas de tu reserva
    </div>

    <form [formGroup]="modificarForm" class="modificar-popup-content">
        <!-- Fecha -->
        <div class="calendar-section">
            <div class="section-header">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 2V6" stroke="#1268C4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M16 2V6" stroke="#1268C4" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                    <path
                        d="M19 4H5C3.89543 4 3 4.89543 3 6V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V6C21 4.89543 20.1046 4 19 4Z"
                        stroke="#1268C4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M3 10H21" stroke="#1268C4" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                <span>Fecha</span>
            </div>
            <div class="calendar-placeholder">
                <mat-card class="demo-inline-calendar-card">
                    <mat-calendar [selected]="modificarForm.get('fecha')?.value || null"
                        (selectedChange)="onFechaSeleccionada($event)" [minDate]="minDate" [maxDate]="maxDate"
                        [dateFilter]="esDiaHabilitado">
                    </mat-calendar>
                </mat-card>
            </div>
            <mat-error *ngIf="mensajeErrorDia" class="error-dia">
                {{ mensajeErrorDia }}
            </mat-error>
        </div>

        <!-- Hora -->
        <div class="time-section">
            <div class="section-header">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 6V12L16 14" stroke="#1268C4" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                    <path
                        d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
                        stroke="#1268C4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <span>Hora</span>
                <div *ngIf="espacioSeleccionado" class="section-sub">
                    {{espacioSeleccionado.horaInicio}} - {{espacioSeleccionado.horaFin}} | Máx
                    {{espacioSeleccionado.tiempoMaximo}}h
                </div>
            </div>
            <div class="timepicker-row">
                <mat-form-field class="timepicker-field" appearance="outline">
                    <mat-label>Hora inicio</mat-label>
                    <input
                        matInput
                        type="time"
                        formControlName="horaInicio"
                        />
                </mat-form-field>
                <mat-form-field class="timepicker-field" appearance="outline">
                    <mat-label>Hora fin</mat-label>
                    <input
                        matInput
                        type="time"
                        formControlName="horaFin"
                        />
                </mat-form-field>
            </div>
            <mat-error *ngIf="f['horaInicio']?.errors?.['required'] && f['horaInicio'].touched">
                Hora de inicio requerida
            </mat-error>
            <mat-error *ngIf="f['horaFin']?.errors?.['required'] && f['horaFin'].touched">
                Hora de fin requerida
            </mat-error>
            <mat-error *ngIf="modificarForm.hasError('finMasTemprano')">
                Hora fin debe ser posterior a inicio
            </mat-error>
            <mat-error *ngIf="modificarForm.hasError('inicioAntesDeApertura')">
                Antes de hora de apertura
            </mat-error>
            <mat-error *ngIf="modificarForm.hasError('finDespuesDeCierre')">
                Después de hora de cierre
            </mat-error>
            <mat-error *ngIf="modificarForm.hasError('excedeTiempoMaximo')">
                Excede tiempo máximo permitido
            </mat-error>

            <div class="personas-section">
                <div class="section-header">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H7C5.93913 15 4.92172 15.4214 4.17157 16.1716C3.42143 16.9217 3 17.9391 3 19V21"
                            stroke="#1268C4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M9 11C9 12.1046 8.10457 13 7 13C5.89543 13 5 12.1046 5 11C5 9.89543 5.89543 9 7 9C8.10457 9 9 9.89543 9 11Z"
                            stroke="#1268C4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M21 21V19C21 17.9391 20.5786 16.9217 19.8284 16.1716C19.0783 15.4214 18.0609 15 17 15H15C13.9391 15 12.9217 15.4214 12.1716 16.1716C11.4214 16.9217 11 17.9391 11 19V21"
                            stroke="#1268C4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M17 11C17 12.1046 16.1046 13 15 13C13.8954 13 13 12.1046 13 11C13 9.89543 13.8954 9 15 9C16.1046 9 17 9.89543 17 11Z"
                            stroke="#1268C4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <span>Personas</span>
                    <div *ngIf="espacioSeleccionado" class="section-sub">
                        Máx {{espacioSeleccionado.cantidadPersonas}}
                    </div>
                </div>
                <mat-form-field class="personas-field" appearance="outline">
                    <mat-label>Cantidad</mat-label>
                    <input matInput type="number" formControlName="cantidadPersonas" min="1" />
                </mat-form-field>
                <mat-error *ngIf="f['cantidadPersonas']?.errors?.['required']">
                    Cantidad requerida
                </mat-error>
                <mat-error *ngIf="f['cantidadPersonas']?.errors?.['min']">
                    Mínimo 1 persona
                </mat-error>
                <mat-error *ngIf="f['cantidadPersonas']?.errors?.['sobreCupo']">
                    Excede cupo máximo
                </mat-error>
            </div>

        </div>

    </form>

    <div class="modificar-popup-actions">
        <button class="cancelar-btn" type="button" (click)="close()">Cancelar</button>
        <button class="guardar-btn" type="button" (click)="modificarReserva()"
            [disabled]="modificarForm.invalid || !espacioSeleccionado">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 6L9 17L4 12" stroke="white" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
            Guardar Cambios
        </button>
    </div>
</div>